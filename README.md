# 数字标牌流媒体播放系统

## 🎯 系统概述

这是一个完整的**流媒体播放系统**，实现了服务器端与客户端的实时内容推送和播放。

### 核心功能
- ✅ **实时流媒体推送**: 内容从服务器实时推送到显示终端
- ✅ **自动调度播放**: 根据排程自动切换播放内容
- ✅ **多终端支持**: 支持TV、PC等不同显示设备
- ✅ **智能轮播**: 图片和视频自动播放切换

## 🏗️ 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   管理后台      │    │   调度服务      │    │   流媒体客户端   │
│  (Next.js)     │───▶│  (Spring Boot)  │───▶│  (Electron)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 数据流向
1. **管理后台** → 创建排程(schedule)和内容
2. **调度服务** → 根据时间推送播放指令
3. **客户端** → 接收指令并播放对应内容

## 🚀 快速开始

### 环境要求
- Node.js 16+
- npm 或 yarn
- 后端服务正常运行

### 安装依赖
```bash
cd panel-agent-main
npm install
```

### 配置系统
编辑 `agent-config.json`:
```json
{
  "backendUrl": "http://116.62.64.33:3000",
  "playerBaseUrl": "http://116.62.64.33:3000/auto-player?scheduleId=xxx",
  "panelId": 21,
  "pollingInterval": 1000,
  "credentials": { 
    "username": "admin_cbw", 
    "password": "123456" 
  }
}
```
（需要填写对应panelid以及它的账号，以上为默认演示账号）

### 启动客户端
```bash
npm start
```
### 🇨🇳 国内环境安装指南（无法 `npm install` / Electron 下载失败时）

在中国大陆网络环境下，建议先切换 npm 源，并为 Electron 等二进制依赖配置国内镜像。

---

#### 💻 一键安装（Windows PowerShell）
```powershell
# 1) 使用淘宝源（npmmirror）
npm config set registry https://registry.npmmirror.com

# 2) 可选：安装 cnpm（国内更稳）
npm install -g cnpm --registry=https://registry.npmmirror.com

# 3) 为 Electron 设置国内镜像（持久环境变量）
setx ELECTRON_MIRROR https://npmmirror.com/mirrors/electron/

# 4) 安装依赖（任意一种）
# 推荐：npm
npm install
# 或：cnpm
# cnpm install

# 5) 如果启动提示“'electron' 不是内部或外部命令”
#   表示项目里尚未安装 electron，补装一次（会从国内镜像下载二进制）
npm install electron --save-dev
```

## 🔧 工作原理

### 1. 调度检查
- 客户端每1秒轮询后端API
- 检查当前面板是否有播放指令
- 获取调度ID和播放时长

### 2. 内容播放
- 根据调度ID获取内容列表
- 创建全屏Electron窗口
- 加载auto-player页面播放内容

### 3. 自动切换
- 图片显示5秒后自动切换
- 视频播放完成后自动切换
- 循环播放直到调度结束

## 📱 客户端特性

### Electron客户端优势
- ✅ **全屏播放**: 系统级全屏，无边框干扰
- ✅ **自动管理**: 根据调度自动打开/关闭
- ✅ **高性能**: 原生应用性能，流畅播放
- ✅ **跨平台**: 支持Windows、macOS、Linux

### 播放模式
- **图片轮播**: 5秒间隔自动切换
- **视频播放**: 播放完成后自动切换
- **调度切换**: 根据时间自动切换不同调度

## 🧪 测试验证

### 流媒体功能验证
1. **创建测试调度**
   - 在管理后台创建包含图片/视频的调度
   - 设置当前时间为播放时间

2. **启动客户端**
   - 运行 `npm start`
   - 观察Electron窗口是否全屏打开

3. **验证实时播放**
   - 内容是否按排程自动播放
   - 图片/视频是否自动切换
   - 调度变更是否实时生效

### 测试要点
- ✅ 内容实时推送到客户端
- ✅ 按排程自动播放
- ✅ 自动轮播和切换
- ✅ 调度变更实时生效

## 🔍 技术实现

### 核心组件
- **main.js**: 主程序入口，启动调度检查
- **schedule-checker.js**: 调度检查和播放控制
- **browser-controller.js**: Electron窗口管理
- **auth.js**: 认证和token管理
- **auto-player.js**: 前端播放器页面

### 关键技术
- **实时轮询**: 1秒间隔检查调度更新
- **动态URL**: 根据调度ID动态生成播放地址
- **全屏控制**: Electron全屏窗口管理
- **自动切换**: 基于时间的自动内容切换

## 📊 配置参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| backendUrl | 后端服务地址 | http://116.62.64.33:3000 |
| panelId | 面板唯一标识 | 21 |
| pollingInterval | 轮询间隔(毫秒) | 1000 |
| playerBaseUrl | 播放器基础URL | auto-player页面地址 |

## 🚨 故障排除

### 常见问题
1. **无法连接后端**
   - 检查网络连接
   - 验证backendUrl配置
   - 确认后端服务状态

2. **无法播放内容**
   - 检查调度时间设置
   - 验证内容文件URL
   - 查看控制台错误信息

3. **播放卡顿**
   - 调整pollingInterval
   - 检查网络带宽
   - 优化内容文件大小

### 调试方法
- 查看控制台输出
- 检查网络请求
- 验证配置文件

## 📈 性能优化

### 轮询优化
- 当前轮询间隔: 1秒
- 可根据需求调整: 5-10秒
- 平衡实时性和服务器负载

### 播放优化
- 图片预加载
- 视频缓冲优化
- 内存管理

## 🔮 扩展功能

### 未来增强
- 多面板同时播放
- 远程监控和控制
- 播放统计和报告
- 内容缓存优化

## 📞 技术支持

### 系统要求
- 后端服务正常运行
- 网络连接稳定
- 内容文件可访问

### 联系信息
如有问题，请检查：
1. 配置文件参数
2. 网络连接状态
3. 后端服务状态
4. 控制台错误信息

---

## 🎉 总结

这个系统完全实现了**流媒体播放系统**的要求：

1. ✅ **服务器端**: Spring Boot提供调度API
2. ✅ **客户端**: Electron应用作为显示终端
3. ✅ **实时推送**: 1秒间隔检查调度更新
4. ✅ **流媒体播放**: 支持图片和视频自动播放
5. ✅ **PC模拟面板**: Electron全屏窗口模拟数字标牌

**老师可以用自己的PC作为客户端进行测试**，只需运行 `npm start` 即可启动流媒体客户端！ 
